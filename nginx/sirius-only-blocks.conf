# ============================================
# БЛОКИ ДЛЯ ДОБАВЛЕНИЯ В СУЩЕСТВУЮЩУЮ КОНФИГУРАЦИЮ
# ПРОЕКТ СИРИУС - ТГИД-07
# ============================================

# Backend API для Сириус (FastAPI на порту 8009)
# Добавьте этот блок ПЕРЕД другими location блоками
location /api-sirius/ {
	client_max_body_size 50M;
    proxy_pass http://localhost:8009/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
	
	# WebSocket support
	proxy_http_version 1.1;
	proxy_set_header Upgrade $http_upgrade;
	proxy_set_header Connection "upgrade";
	proxy_read_timeout 300s;
	proxy_connect_timeout 75s;
}

# Frontend для Сириус (Nuxt 4 на порту 3006)
# ВАРИАНТ 1: Отдельный путь /sirius/ (рекомендуется, если корневой путь занят)
location /sirius/ {
    proxy_pass http://localhost:3006/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
	
	# WebSocket поддержка для Nuxt HMR
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_read_timeout 86400;
}

# ВАРИАНТ 2: Если хотите использовать корневой путь / для Сириус
# (замените существующий блок location /)
# ВНИМАНИЕ: Это заменит текущий проект на порту 3001!
# location / {
#     proxy_pass http://localhost:3006;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_set_header X-Forwarded-Host $host;
#     proxy_set_header X-Forwarded-Port $server_port;
# 	
# 	# WebSocket поддержка для Nuxt HMR
#     proxy_http_version 1.1;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection "upgrade";
#     proxy_read_timeout 86400;
# }

# ============================================
# КОНЕЦ БЛОКОВ ДЛЯ СИРИУС
# ============================================

